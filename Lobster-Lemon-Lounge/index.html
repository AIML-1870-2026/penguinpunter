<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Lobster Lemon Lounge â€” Blackjack</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --felt:#1a5c25;--felt2:#0d3d16;
  --panel:rgba(6,28,10,0.82);
  --coral:#e8523a;--lemon:#f5e642;--text:#f0f0e8;
  --teal:#1a7a50;--gold:#ffd700;
  --cw:72px;--ch:104px;
}
body{
  background:
    radial-gradient(ellipse 80% 60% at 40% 30%,rgba(40,110,55,0.5) 0%,transparent 70%),
    radial-gradient(ellipse 60% 80% at 80% 80%,rgba(0,0,0,0.35) 0%,transparent 60%),
    #1a5c25;
  color:var(--text);font-family:system-ui,sans-serif;
  min-height:100vh;display:flex;flex-direction:column;
  align-items:center;justify-content:flex-start;
  padding:14px;overflow-x:hidden;position:relative;
}
/* felt weave texture */
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;
  background-image:
    repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(0,0,0,0.018) 3px,rgba(0,0,0,0.018) 6px),
    repeating-linear-gradient(90deg,transparent,transparent 3px,rgba(0,0,0,0.012) 3px,rgba(0,0,0,0.012) 6px);
}
#particle-canvas{position:fixed;inset:0;pointer-events:none;z-index:999}
#app{position:relative;z-index:1;width:100%;max-width:720px}
/* â”€â”€â”€ PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.panel{
  background:var(--panel);
  border:1px solid rgba(255,255,255,0.07);
  border-radius:18px;
  box-shadow:0 20px 60px rgba(0,0,0,0.55),0 0 0 4px rgba(0,0,0,0.18),inset 0 1px 0 rgba(255,255,255,0.04);
  backdrop-filter:blur(4px);
  overflow:hidden;position:relative;
}
/* â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
.header{
  background:linear-gradient(135deg,rgba(0,0,0,0.42),rgba(0,0,0,0.22));
  border-bottom:2px solid var(--coral);
  padding:13px 16px;
  display:flex;align-items:center;justify-content:space-between;gap:8px;
}
.header h1{font-family:Georgia,serif;font-size:1.2rem;font-weight:bold;color:var(--lemon)}
.header p{font-size:0.68rem;color:var(--coral);font-style:italic;margin-top:2px}
.hdr-btns{display:flex;gap:6px;flex-shrink:0;flex-wrap:wrap}
.btn-sm{
  background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.14);
  color:var(--text);padding:5px 11px;border-radius:20px;cursor:pointer;
  font-size:0.73rem;transition:background .2s,transform .15s;white-space:nowrap;
}
.btn-sm:hover{background:rgba(255,255,255,0.14);transform:scale(1.05)}
.btn-sm.active{background:var(--teal);border-color:var(--teal)}
/* â”€â”€â”€ INFO BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.info-bar{
  background:rgba(0,0,0,0.18);border-bottom:1px solid rgba(255,255,255,0.06);
  padding:7px 16px;display:flex;align-items:center;gap:14px;font-size:0.73rem;flex-wrap:wrap;
}
.shoe-wrap{display:flex;align-items:center;gap:7px;flex:1}
.shoe-bar{width:100px;height:5px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden}
.shoe-fill{height:100%;background:linear-gradient(90deg,var(--coral),var(--lemon));border-radius:3px;transition:width .6s}
.shoe-lbl{color:rgba(240,240,232,0.5);white-space:nowrap}
.count-wrap{display:flex;gap:11px}
.cnt{color:rgba(240,240,232,0.45)}
.cval{font-weight:bold}
.cp{color:#4dff88}.cn{color:var(--coral)}.cz{color:var(--lemon)}
.tell{font-size:0.72rem;font-style:italic;transition:all .4s;margin-left:auto;white-space:nowrap}
/* â”€â”€â”€ BET BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bet-bar{
  background:rgba(0,0,0,0.12);border-bottom:1px solid rgba(255,255,255,0.06);
  padding:9px 16px;display:flex;align-items:center;gap:9px;flex-wrap:wrap;
}
.bet-bar label{font-size:0.8rem;white-space:nowrap}
.bet-input{
  width:78px;background:rgba(0,0,0,0.32);border:1px solid rgba(255,255,255,0.14);
  color:var(--lemon);padding:5px 8px;border-radius:6px;font-size:0.92rem;
  font-weight:bold;text-align:center;
}
.bet-input:focus{outline:none;border-color:var(--lemon)}
.bal{color:var(--lemon);font-weight:bold;font-size:0.92rem;margin-left:auto;white-space:nowrap}
.btn-deal{
  background:var(--coral);border:none;color:#fff;padding:8px 17px;
  border-radius:8px;font-size:0.88rem;font-weight:bold;cursor:pointer;
  transition:transform .15s,filter .15s,opacity .2s;white-space:nowrap;
}
.btn-deal:hover:not(:disabled){transform:scale(1.05);filter:brightness(1.1)}
.btn-deal:disabled{opacity:.4;cursor:not-allowed;transform:none;filter:none}
/* â”€â”€â”€ PLAY AREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.play-area{
  padding:14px 16px 8px;
  background:radial-gradient(ellipse at 50% 50%,rgba(255,255,255,0.018) 0%,transparent 70%);
}
.hand-lbl{
  display:flex;align-items:center;justify-content:space-between;
  margin-bottom:8px;font-size:0.76rem;text-transform:uppercase;
  letter-spacing:1px;color:rgba(240,240,232,0.5);font-weight:bold;
}
.score-badge{
  background:rgba(0,0,0,0.32);border:1px solid rgba(255,255,255,0.09);
  padding:2px 10px;border-radius:10px;font-size:0.85rem;color:var(--lemon);font-weight:bold;
}
.cards-row{display:flex;flex-wrap:wrap;gap:7px;min-height:110px;align-items:flex-start}
/* â”€â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card{
  width:var(--cw);height:var(--ch);border-radius:8px;
  background:#fefefe;border:1px solid rgba(0,0,0,0.14);
  box-shadow:3px 4px 14px rgba(0,0,0,0.55),inset 0 1px 0 rgba(255,255,255,0.85);
  position:relative;flex-shrink:0;
  display:flex;flex-direction:column;justify-content:space-between;
  padding:4px 5px;overflow:hidden;
  animation:dealCard .32s cubic-bezier(.22,.61,.36,1);
}
@keyframes dealCard{
  from{transform:translateY(-55px) translateX(35px) rotate(-7deg) scale(.88);opacity:0}
  to{transform:none;opacity:1}
}
.card.red{color:#cc1010}.card.black{color:#111}
.corner{display:flex;flex-direction:column;align-items:center;line-height:1.1;font-weight:800}
.corner.br{transform:rotate(180deg);align-self:flex-end}
.rank{font-size:.78rem}.suit-sm{font-size:.6rem}
.cmid{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  text-align:center;line-height:1;pointer-events:none;
}
.big-suit{font-size:2rem}
.face-letter{font-family:Georgia,serif;font-size:2rem;font-weight:bold;display:block}
.face-deco{font-size:.5rem;letter-spacing:2px;opacity:.4;display:block;margin-top:2px}
/* face card inner border */
.card.face::after{
  content:'';position:absolute;inset:4px;border:1px solid currentColor;
  border-radius:4px;opacity:.12;pointer-events:none;
}
/* card back */
.card.back{
  background:repeating-linear-gradient(45deg,#8b1c2e 0,#8b1c2e 6px,#6e1524 6px,#6e1524 12px);
  border-color:rgba(0,0,0,0.28);align-items:center;justify-content:center;
  display:flex;
}
.card.back::before{content:'ğŸ¦';font-size:1.8rem;opacity:.45}
/* flip wrapper */
.flip-wrap{width:var(--cw);height:var(--ch);perspective:900px;flex-shrink:0}
.flip-inner{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .55s cubic-bezier(.4,0,.2,1)}
.flip-inner.flipped{transform:rotateY(180deg)}
.flip-front,.flip-back{position:absolute;inset:0;backface-visibility:hidden;border-radius:8px}
.flip-back{transform:rotateY(180deg)}
/* â”€â”€â”€ DIVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.divider{
  text-align:center;color:var(--lemon);font-size:.7rem;letter-spacing:4px;
  margin:10px 0;opacity:.5;display:flex;align-items:center;gap:10px;
}
.divider::before,.divider::after{content:'';flex:1;border-top:1px solid rgba(245,230,66,.2)}
/* â”€â”€â”€ SPLIT LABELS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.split-lbl{font-size:.66rem;color:var(--lemon);font-weight:bold;text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
/* â”€â”€â”€ HINT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hint-bar{
  margin-top:7px;min-height:24px;text-align:center;font-size:.76rem;
  padding:3px 12px;border-radius:6px;transition:all .3s;
}
.h-hit  {background:rgba(232,82,58,.13);color:#ff8a76;border:1px solid rgba(232,82,58,.28)}
.h-stand{background:rgba(245,230,66,.1);color:var(--lemon);border:1px solid rgba(245,230,66,.22)}
.h-double{background:rgba(100,200,255,.1);color:#7acfff;border:1px solid rgba(100,200,255,.22)}
.h-split{background:rgba(100,255,150,.1);color:#4dff88;border:1px solid rgba(100,255,150,.22)}
.h-off  {background:transparent;color:transparent;border:1px solid transparent}
/* â”€â”€â”€ ACTION BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.action-bar{
  border-top:1px solid rgba(255,255,255,.06);
  padding:11px 16px;display:flex;flex-direction:column;gap:8px;
}
.bet-display{text-align:center;font-size:.8rem;color:rgba(240,240,232,.5)}
.bet-display span{color:var(--lemon);font-weight:bold}
.action-btns{display:flex;gap:7px;justify-content:center;flex-wrap:wrap}
.btn-a{
  padding:10px 15px;border-radius:8px;font-size:.86rem;font-weight:bold;cursor:pointer;
  transition:transform .15s,filter .15s,opacity .2s;border:2px solid transparent;min-width:84px;
}
.btn-a:hover:not(:disabled){transform:scale(1.06);filter:brightness(1.12)}
.btn-a:disabled{opacity:.3;cursor:not-allowed;transform:none;filter:none}
.b-hit  {background:var(--coral);color:#fff}
.b-stand{background:transparent;color:var(--lemon);border-color:var(--lemon)}
.b-dbl  {background:transparent;color:#7acfff;border-color:#7acfff}
.b-spl  {background:transparent;color:#4dff88;border-color:#4dff88}
/* â”€â”€â”€ STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.status{
  border-top:1px solid rgba(255,255,255,.06);
  padding:10px 16px;text-align:center;font-size:.86rem;
  font-style:italic;color:rgba(240,240,232,.65);min-height:40px;transition:color .3s;
}
.s-win {color:#4dff88}.s-lose{color:var(--coral)}.s-push{color:var(--lemon)}
.s-bj  {color:var(--gold);font-weight:bold;font-size:.98rem}
/* â”€â”€â”€ WIN ANIMATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes glowPulse{0%,100%{box-shadow:none}50%{box-shadow:0 0 24px 8px rgba(77,255,136,.28)}}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-7px)}40%{transform:translateX(7px)}60%{transform:translateX(-5px)}80%{transform:translateX(5px)}}
.anim-glow{animation:glowPulse .6s ease-in-out 3}
.anim-shake{animation:shake .5s ease-in-out}
/* â”€â”€â”€ OVERLAYS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.overlay{
  display:none;position:absolute;inset:0;background:rgba(0,0,0,.78);
  border-radius:18px;z-index:60;align-items:center;justify-content:center;
}
.overlay.vis{display:flex}
.obox{
  background:#071a0a;border:2px solid var(--gold);border-radius:14px;
  padding:26px 30px;text-align:center;max-width:360px;width:90%;
  box-shadow:0 0 30px rgba(255,215,0,.18);
}
.obox h3{font-family:Georgia,serif;font-size:1.25rem;color:var(--gold);margin-bottom:10px}
.obox p{font-size:.88rem;color:var(--text);line-height:1.55;margin-bottom:5px}
.obox .note{font-size:.75rem;color:rgba(240,240,232,.45);font-style:italic}
.ins-btns{display:flex;gap:11px;justify-content:center;margin-top:16px}
.btn-yes{background:var(--gold);color:#1a1a0a;border:none;padding:10px 20px;border-radius:8px;font-weight:bold;cursor:pointer;font-size:.88rem;transition:transform .15s}
.btn-yes:hover{transform:scale(1.05)}
.btn-no{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.2);padding:10px 20px;border-radius:8px;font-weight:bold;cursor:pointer;font-size:.88rem;transition:transform .15s,background .2s}
.btn-no:hover{background:rgba(255,255,255,.08);transform:scale(1.05)}
/* game over */
#go{background:rgba(0,0,0,.9)}
#go h2{font-family:Georgia,serif;font-size:1.65rem;color:var(--coral)}
#go p{color:rgba(240,240,232,.72);font-size:.92rem}
.btn-restart{background:var(--lemon);color:#1a1a0a;border:none;padding:12px 26px;border-radius:8px;font-size:.98rem;font-weight:bold;cursor:pointer;transition:transform .15s;margin-top:6px}
.btn-restart:hover{transform:scale(1.05)}
/* â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-bg{
  display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);
  z-index:200;align-items:center;justify-content:center;
}
.modal-bg.vis{display:flex}
.mbox{
  background:#071e0b;border:1px solid rgba(255,255,255,.11);border-radius:14px;
  padding:26px;max-width:500px;width:92%;max-height:90vh;overflow-y:auto;
  box-shadow:0 12px 50px rgba(0,0,0,.6);position:relative;
}
.mbox h2{font-family:Georgia,serif;color:var(--lemon);margin-bottom:8px;font-size:1.2rem}
.mbox h3{color:var(--lemon);font-size:.88rem;margin:14px 0 5px;text-transform:uppercase;letter-spacing:.5px}
.mbox p,.mbox li{color:var(--text);font-size:.85rem;line-height:1.6}
.mbox ul{margin:3px 0 10px 16px}
.mbox kbd{background:rgba(0,0,0,.4);border:1px solid rgba(255,255,255,.18);border-radius:4px;padding:1px 6px;font-family:monospace;color:var(--lemon);font-size:.8rem}
.mbox hr{border:none;border-top:1px solid rgba(255,255,255,.07);margin:12px 0}
.mclose{position:absolute;top:11px;right:13px;background:none;border:none;color:var(--text);font-size:1.35rem;cursor:pointer;opacity:.5;transition:opacity .15s;line-height:1}
.mclose:hover{opacity:1}
/* â”€â”€â”€ INSTRUCTIONS MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.instr-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
.instr-card{
  background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.07);
  border-radius:8px;padding:10px 12px;
}
.instr-card .ic-title{color:var(--lemon);font-size:.8rem;font-weight:bold;margin-bottom:4px}
.instr-card p{font-size:.78rem;color:rgba(240,240,232,.7)}
.shortcut-row{display:flex;gap:8px;align-items:center;margin-top:5px}
</style>
</head>
<body>
<canvas id="particle-canvas"></canvas>
<div id="app">
<div class="panel">

  <!-- Insurance overlay -->
  <div class="overlay" id="ins-overlay">
    <div class="obox">
      <h3>ğŸ›¡ï¸ Insurance?</h3>
      <p>Dealer shows an <strong>Ace</strong>.<br>Insure for $<strong id="ins-amt">0</strong>?</p>
      <p class="note">Pays 2:1 if dealer has Blackjack</p>
      <div class="ins-btns">
        <button class="btn-yes" id="btn-ins-yes">Yes, insure!</button>
        <button class="btn-no"  id="btn-ins-no">No thanks</button>
      </div>
    </div>
  </div>

  <!-- Game over overlay -->
  <div class="overlay" id="go">
    <div class="obox" style="border-color:var(--coral)">
      <h2>ğŸ¦ Out of Chips!</h2>
      <p style="margin-top:6px">You're out of chips! The lobster wins. ğŸ¦</p>
      <button class="btn-restart" onclick="resetGame()">Start Over</button>
    </div>
  </div>

  <!-- Header -->
  <div class="header">
    <div>
      <h1>ğŸ¦ The Lobster Lemon Lounge</h1>
      <p>"The House Always Claws Back"</p>
    </div>
    <div class="hdr-btns">
      <button class="btn-sm" id="btn-count" onclick="toggleCount()">ğŸƒ Count</button>
      <button class="btn-sm" id="btn-hints" onclick="toggleHints()">ğŸ’¡ Hints</button>
      <button class="btn-sm" onclick="openModal('howto')">ğŸ“– How To Play</button>
      <button class="btn-sm" onclick="openModal('about')">â„¹ About</button>
    </div>
  </div>

  <!-- Info bar -->
  <div class="info-bar">
    <div class="shoe-wrap">
      <span class="shoe-lbl">Shoe:</span>
      <div class="shoe-bar"><div class="shoe-fill" id="shoe-fill" style="width:100%"></div></div>
      <span class="shoe-lbl" id="shoe-lbl">312/312</span>
    </div>
    <div class="count-wrap" id="count-wrap" style="display:none">
      <span class="cnt">Running: <span class="cval cz" id="rc">+0</span></span>
      <span class="cnt">True: <span class="cval cz" id="tc">+0.0</span></span>
    </div>
    <div class="tell" id="tell" style="opacity:0">â€”</div>
  </div>

  <!-- Bet bar -->
  <div class="bet-bar">
    <label for="bet-in">Bet Amount:</label>
    <input type="number" id="bet-in" class="bet-input" value="10" min="1">
    <div class="bal">ğŸ’› Balance: $<span id="bal-val">1000</span></div>
    <button class="btn-deal" id="btn-deal" onclick="deal()">ğŸ¦ DEAL</button>
  </div>

  <!-- Play area -->
  <div class="play-area">

    <!-- Dealer -->
    <div>
      <div class="hand-lbl">
        <span>ğŸ¦ Dealer</span>
        <span class="score-badge" id="d-score">--</span>
      </div>
      <div class="cards-row" id="d-cards"></div>
    </div>

    <div class="divider">ğŸ‹ &nbsp;Â·&nbsp;Â·&nbsp;Â·&nbsp;Â·&nbsp;Â·&nbsp;Â·&nbsp;Â·&nbsp; ğŸ‹</div>

    <!-- Player -->
    <div id="player-wrap">
      <div class="hand-lbl">
        <span>Player</span>
        <span class="score-badge" id="p-score">--</span>
      </div>
      <div class="split-lbl" id="sl0" style="display:none">Hand 1 â–¶</div>
      <div class="cards-row" id="p-cards"></div>
      <div class="split-lbl" id="sl1" style="display:none;margin-top:10px">Hand 2</div>
      <div class="cards-row" id="p-cards1" style="display:none;margin-top:6px"></div>
    </div>

    <div class="hint-bar h-off" id="hint-bar"></div>

  </div>

  <!-- Action bar -->
  <div class="action-bar">
    <div class="bet-display">Current Bet: $<span id="cur-bet">0</span></div>
    <div class="action-btns">
      <button class="btn-a b-hit"   id="b-hit"   onclick="hit()"       disabled>ğŸ¦ HIT</button>
      <button class="btn-a b-stand" id="b-stand"  onclick="stand()"     disabled>ğŸ‹ STAND</button>
      <button class="btn-a b-dbl"   id="b-dbl"    onclick="dblDown()"   disabled>DOUBLE</button>
      <button class="btn-a b-spl"   id="b-spl"    onclick="splitHand()" disabled>SPLIT</button>
    </div>
  </div>

  <!-- Status -->
  <div class="status" id="status">Place your bet and click Deal to begin.</div>

</div><!-- /.panel -->
</div><!-- /#app -->

<!-- HOW TO PLAY MODAL -->
<div class="modal-bg" id="howto-modal" onclick="bgClose(event,'howto-modal')">
  <div class="mbox">
    <button class="mclose" onclick="closeModal('howto-modal')">âœ•</button>
    <h2>ğŸ“– How To Play Blackjack</h2>
    <p>Beat the dealer by getting closer to <strong style="color:var(--lemon)">21</strong> without going over.</p>

    <h3>Card Values</h3>
    <div class="instr-grid">
      <div class="instr-card"><div class="ic-title">Number Cards (2â€“10)</div><p>Worth their face value.</p></div>
      <div class="instr-card"><div class="ic-title">Face Cards (J, Q, K)</div><p>Worth <strong>10</strong> each.</p></div>
      <div class="instr-card"><div class="ic-title">Ace</div><p>Worth <strong>11</strong> or <strong>1</strong> â€” whichever helps you more.</p></div>
      <div class="instr-card"><div class="ic-title">Blackjack ğŸ¦ğŸ‹</div><p>Ace + any 10-value card on first deal. Pays <strong>1.5Ã—</strong>!</p></div>
    </div>

    <h3>Your Actions</h3>
    <div class="instr-grid">
      <div class="instr-card"><div class="ic-title">ğŸ¦ HIT</div><p>Draw another card. Keep going until you're happy or bust (over 21).</p></div>
      <div class="instr-card"><div class="ic-title">ğŸ‹ STAND</div><p>Stop drawing. The dealer then plays their hand.</p></div>
      <div class="instr-card"><div class="ic-title">DOUBLE</div><p>Double your bet, receive exactly one more card, then stand. Only on first 2 cards.</p></div>
      <div class="instr-card"><div class="ic-title">SPLIT</div><p>If you have two equal-value cards, split into two separate hands. Each gets its own bet.</p></div>
    </div>

    <h3>Insurance</h3>
    <p>When the dealer shows an Ace, you can bet up to half your current bet on insurance. If the dealer has Blackjack, insurance pays <strong>2:1</strong>. Otherwise you lose the insurance bet.</p>

    <h3>Dealer Rules</h3>
    <p>The dealer must hit on any hand scoring 16 or less, and stand on 17 or more. You can't control the dealer â€” but you can outsmart the lobster.</p>

    <h3>Special Features in This Game</h3>
    <ul>
      <li><strong>ğŸƒ Count</strong> â€” Hi-Lo running & true count (educational)</li>
      <li><strong>ğŸ’¡ Hints</strong> â€” Basic strategy suggestions for every hand</li>
      <li><strong>ğŸ¦ Dealer Tells</strong> â€” Subtle educational hints about the hole card</li>
      <li><strong>6-Deck Shoe</strong> â€” Reshuffled when 25% of cards remain</li>
    </ul>

    <h3>Keyboard Shortcuts</h3>
    <div class="shortcut-row"><kbd>D</kbd><span style="font-size:.83rem;color:var(--text)">Deal</span></div>
    <div class="shortcut-row"><kbd>H</kbd><span style="font-size:.83rem;color:var(--text)">Hit</span></div>
    <div class="shortcut-row"><kbd>S</kbd><span style="font-size:.83rem;color:var(--text)">Stand</span></div>
    <div class="shortcut-row"><kbd>W</kbd><span style="font-size:.83rem;color:var(--text)">Double Down</span></div>
    <div class="shortcut-row"><kbd>P</kbd><span style="font-size:.83rem;color:var(--text)">Split</span></div>
  </div>
</div>

<!-- ABOUT MODAL -->
<div class="modal-bg" id="about-modal" onclick="bgClose(event,'about-modal')">
  <div class="mbox">
    <button class="mclose" onclick="closeModal('about-modal')">âœ•</button>
    <h2>ğŸ¦ğŸ‹ The Lobster Lemon Lounge</h2>
    <p><em>Welcome to The Lobster Lemon Lounge, where the dealer has claws and the drinks come with a garnish.</em></p>
    <hr>
    <h3>Rules Summary</h3>
    <ul>
      <li>6-deck shoe â€” reshuffled when 25% of cards remain</li>
      <li>Dealer stands on 17+, hits on 16 and below</li>
      <li>Blackjack pays 1.5Ã— Â· Push returns your bet</li>
      <li>Double Down: double bet, one card, then stand</li>
      <li>Split: two equal-value cards â†’ two hands, same bet each</li>
      <li>Insurance: offered when dealer shows Ace, pays 2:1</li>
      <li>Start with $1,000 Â· Min $1 Â· Max = full balance</li>
    </ul>
    <hr>
    <h3>Card Counting (Hi-Lo)</h3>
    <ul>
      <li>Cards 2â€“6: <span style="color:#4dff88">+1</span> (good for player)</li>
      <li>Cards 7â€“9: 0 (neutral)</li>
      <li>Cards 10â€“A: <span style="color:var(--coral)">âˆ’1</span> (good for dealer)</li>
      <li>True Count = Running Count Ã· Decks Remaining</li>
    </ul>
  </div>
</div>

<script>
// â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const NUM_DECKS   = 6;
const TOTAL       = NUM_DECKS * 52;       // 312
const CUT_CARD    = Math.floor(TOTAL * .25); // reshuffle at 25% left

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let balance=1000, currentBet=0, handBets=[];
let shoe=[], playerHands=[[]], dealerHand=[];
let activeIdx=0, gameState='idle', holeRevealed=false, insuranceBet=0;
let runningCount=0, showCount=false, showHints=false;

// â”€â”€â”€ SHOE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SUITS =['â™ ','â™£','â™¥','â™¦'];
const VALS  =['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

function buildShoe(){
  shoe=[];
  for(let d=0;d<NUM_DECKS;d++)
    for(const s of SUITS) for(const v of VALS) shoe.push({v,s});
  shuffle(shoe); runningCount=0; updateCountUI(); updateShoeUI();
}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}}
function draw(){
  if(shoe.length<=CUT_CARD){buildShoe();setStatus('ğŸ”€ Shoe reshuffled!')}
  const c=shoe.pop(); hiLo(c); updateShoeUI(); return c;
}

// â”€â”€â”€ HI-LO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hiLo(c){
  const v=c.v;
  if(['2','3','4','5','6'].includes(v))        runningCount++;
  else if(['10','J','Q','K','A'].includes(v))  runningCount--;
  updateCountUI();
}
function trueCount(){
  const dl=shoe.length/52; return dl<.1?runningCount:(runningCount/dl).toFixed(1);
}
function updateCountUI(){
  const rc=runningCount, tc=parseFloat(trueCount());
  const rEl=$('rc'), tEl=$('tc');
  rEl.textContent=(rc>=0?'+':'')+rc;
  tEl.textContent=(tc>=0?'+':'')+tc;
  rEl.className='cval '+(rc>0?'cp':rc<0?'cn':'cz');
  tEl.className='cval '+(tc>0?'cp':tc<0?'cn':'cz');
}
function updateShoeUI(){
  const pct=(shoe.length/TOTAL)*100;
  $('shoe-fill').style.width=pct+'%';
  $('shoe-lbl').textContent=shoe.length+'/'+TOTAL;
}

// â”€â”€â”€ SCORE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function cVal(v){if(v==='A')return 11;if(['J','Q','K'].includes(v))return 10;return parseInt(v)}
function score(hand){
  let t=0,a=0;
  for(const c of hand){t+=cVal(c.v);if(c.v==='A')a++}
  while(t>21&&a>0){t-=10;a--}
  return t;
}
function isSoft(hand){
  let t=0,a=0,r=0;
  for(const c of hand){t+=cVal(c.v);if(c.v==='A')a++}
  while(t>21&&r<a){t-=10;r++}
  return r<a; // at least one ace still counting as 11
}
function isBJ(hand){return hand.length===2&&score(hand)===21}
function isBust(hand){return score(hand)>21}

// â”€â”€â”€ CARD HTML â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function cardHTML(c){
  const red=c.s==='â™¥'||c.s==='â™¦';
  const face=['J','Q','K'].includes(c.v);
  const cls='card '+(red?'red':'black')+(face?' face':'');
  const mid=face
    ?`<div class="cmid"><span class="face-letter">${c.v}</span><span class="face-deco">${c.s}${c.s}${c.s}</span></div>`
    :`<div class="cmid"><span class="big-suit">${c.s}</span></div>`;
  return `<div class="${cls}">
    <div class="corner"><div class="rank">${c.v}</div><div class="suit-sm">${c.s}</div></div>
    ${mid}
    <div class="corner br"><div class="rank">${c.v}</div><div class="suit-sm">${c.s}</div></div>
  </div>`;
}
function backHTML(){return`<div class="card back"></div>`}
function flipHTML(c){
  const red=c.s==='â™¥'||c.s==='â™¦';
  const face=['J','Q','K'].includes(c.v);
  const fcls='card '+(red?'red':'black')+(face?' face':'');
  const mid=face
    ?`<div class="cmid"><span class="face-letter">${c.v}</span><span class="face-deco">${c.s}${c.s}${c.s}</span></div>`
    :`<div class="cmid"><span class="big-suit">${c.s}</span></div>`;
  const faceCard=`<div class="${fcls}" style="position:absolute;inset:0;border-radius:8px;overflow:hidden;display:flex;flex-direction:column;justify-content:space-between;padding:4px 5px">
    <div class="corner"><div class="rank">${c.v}</div><div class="suit-sm">${c.s}</div></div>
    ${mid}
    <div class="corner br"><div class="rank">${c.v}</div><div class="suit-sm">${c.s}</div></div>
  </div>`;
  const backCard=`<div class="card back" style="position:absolute;inset:0;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center"></div>`;
  return `<div class="flip-wrap"><div class="flip-inner" id="hole">
    <div class="flip-front">${backCard}</div>
    <div class="flip-back">${faceCard}</div>
  </div></div>`;
}

// â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDealer(all=false){
  const row=$('d-cards'); row.innerHTML='';
  dealerHand.forEach((c,i)=>{
    if(i===1&&!all&&!holeRevealed) row.insertAdjacentHTML('beforeend',flipHTML(c));
    else row.insertAdjacentHTML('beforeend',cardHTML(c));
  });
  const s=all||holeRevealed?score(dealerHand):score([dealerHand[0]]);
  $('d-score').textContent=all||holeRevealed?s:s+' + ?';
}
function renderPlayer(){
  const hand=playerHands[activeIdx];
  const row=$('p-cards'); row.innerHTML='';
  hand.forEach(c=>row.insertAdjacentHTML('beforeend',cardHTML(c)));
  $('p-score').textContent=hand.length?score(hand):'--';
  if(playerHands.length>1){
    const r2=$('p-cards1'); r2.style.display='flex'; r2.innerHTML='';
    playerHands[1].forEach(c=>r2.insertAdjacentHTML('beforeend',cardHTML(c)));
    $('sl0').style.display='block'; $('sl1').style.display='block';
    $('sl0').textContent=activeIdx===0?'Hand 1 â–¶':'Hand 1 âœ“';
    $('sl1').textContent=activeIdx===1?'Hand 2 â–¶':'Hand 2';
  } else {
    $('p-cards1').style.display='none';
    $('sl0').style.display='none'; $('sl1').style.display='none';
  }
}

// â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setButtons(playing){
  const hand=playerHands[activeIdx];
  $('b-hit').disabled   =!playing;
  $('b-stand').disabled =!playing;
  $('b-dbl').disabled   =!playing||hand.length!==2||balance<handBets[activeIdx];
  $('b-spl').disabled   =!playing||hand.length!==2
    ||cVal(hand[0].v)!==cVal(hand[1].v)
    ||playerHands.length>1||balance<handBets[activeIdx];
  $('btn-deal').disabled=playing;
  $('bet-in').disabled  =playing;
}

// â”€â”€â”€ STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setStatus(msg,cls=''){
  const el=$('status');
  el.className='status'+(cls?' s-'+cls:'');
  el.textContent=msg;
}
function updateBal(){$('bal-val').textContent=balance.toLocaleString()}

// â”€â”€â”€ DEALER TELLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TELLS_HI=['ğŸ¦ A subtle twitch of the antenna.','ğŸ¦ The lobster shifts... uncomfortably.','ğŸ¦ One claw clenches briefly.'];
const TELLS_LO=['ğŸ‹ The lobster seems... relaxed.','ğŸ‹ A satisfied squeeze of lemon.','ğŸ‹ Lounging, almost too casual.'];
function showTell(){
  if(!dealerHand[1]){$('tell').style.opacity=0;return}
  const high=cVal(dealerHand[1].v)>=10;
  const pool=high?TELLS_HI:TELLS_LO;
  const el=$('tell');
  el.textContent=pool[Math.floor(Math.random()*pool.length)];
  el.style.opacity=1;
  el.style.color=high?'rgba(232,82,58,.65)':'rgba(245,230,66,.55)';
}

// â”€â”€â”€ STRATEGY HINTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getHint(hand,upCard){
  const s=score(hand), upV=cVal(upCard.v);
  const pair=hand.length===2&&cVal(hand[0].v)===cVal(hand[1].v);
  const soft=isSoft(hand)&&hand.some(c=>c.v==='A');
  const dbl=hand.length===2, spl=pair&&playerHands.length===1;
  if(spl){
    const pv=cVal(hand[0].v);
    if(pv===11)return{a:'split',t:'âœ‚ Always split Aces'};
    if(pv===8) return{a:'split',t:'âœ‚ Always split 8s'};
    if(pv===10)return{a:'stand',t:'â¬› Never split 10s â€” stand'};
    if(pv===9){return upV===7||upV>=10?{a:'stand',t:'â¬› Stand 9s vs 7/10/A'}:{a:'split',t:'âœ‚ Split 9s'}}
    if(pv===7){return upV<=7?{a:'split',t:'âœ‚ Split 7s vs 2â€“7'}:{a:'hit',t:'â–² Hit 7s vs 8+'}}
    if(pv===6){return upV<=6?{a:'split',t:'âœ‚ Split 6s vs 2â€“6'}:{a:'hit',t:'â–² Hit 6s vs 7+'}}
    if(pv<=3) {return upV<=7?{a:'split',t:`âœ‚ Split ${pv}s vs 2â€“7`}:{a:'hit',t:`â–² Hit ${pv}s vs 8+`}}
    if(pv===4&&upV>=5&&upV<=6)return{a:'split',t:'âœ‚ Split 4s vs 5â€“6'};
  }
  if(soft){
    if(s>=19)return{a:'stand',t:'â¬› Stand â€” soft 19+'};
    if(s===18){
      if(dbl&&upV>=3&&upV<=6)return{a:'double',t:'âš¡ Double soft 18 vs 3â€“6'};
      return upV<=8?{a:'stand',t:'â¬› Stand soft 18 vs 2â€“8'}:{a:'hit',t:'â–² Hit soft 18 vs 9â€“A'};
    }
    if(s===17){return(dbl&&upV>=3&&upV<=6)?{a:'double',t:'âš¡ Double soft 17 vs 3â€“6'}:{a:'hit',t:'â–² Hit soft 17'}}
    if(s===15||s===16){return(dbl&&upV>=4&&upV<=6)?{a:'double',t:`âš¡ Double soft ${s} vs 4â€“6`}:{a:'hit',t:`â–² Hit soft ${s}`}}
    return{a:'hit',t:`â–² Hit soft ${s}`};
  }
  if(s>=17)return{a:'stand',t:'â¬› Stand â€” strong hand'};
  if(s>=13)return upV<=6?{a:'stand',t:`â¬› Stand ${s} vs 2â€“6`}:{a:'hit',t:`â–² Hit ${s} vs 7+`};
  if(s===12)return(upV>=4&&upV<=6)?{a:'stand',t:'â¬› Stand 12 vs 4â€“6'}:{a:'hit',t:'â–² Hit 12 vs 2â€“3/7+'};
  if(s===11)return(dbl&&upV<=10)?{a:'double',t:'âš¡ Double 11 vs 2â€“10!'}:{a:'hit',t:'â–² Hit 11 vs Ace'};
  if(s===10)return(dbl&&upV<=9)?{a:'double',t:'âš¡ Double 10 vs 2â€“9!'}:{a:'hit',t:'â–² Hit 10 vs 10/A'};
  if(s===9) return(dbl&&upV>=3&&upV<=6)?{a:'double',t:'âš¡ Double 9 vs 3â€“6'}:{a:'hit',t:'â–² Hit 9'};
  return{a:'hit',t:'â–² Hit â€” need more cards'};
}
function updateHint(){
  const el=$('hint-bar');
  if(!showHints||gameState!=='playing'||!dealerHand[0]){el.className='hint-bar h-off';el.textContent='';return}
  const h=getHint(playerHands[activeIdx],dealerHand[0]);
  el.className='hint-bar h-'+h.a; el.textContent=h.t;
}

// â”€â”€â”€ TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleCount(){
  showCount=!showCount;
  $('count-wrap').style.display=showCount?'flex':'none';
  $('btn-count').classList.toggle('active',showCount);
}
function toggleHints(){
  showHints=!showHints;
  $('btn-hints').classList.toggle('active',showHints);
  updateHint();
}

// â”€â”€â”€ INSURANCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function offerInsurance(cb){
  const amt=Math.floor(currentBet/2);
  if(amt<=0||balance<amt){cb(0);return}
  $('ins-amt').textContent=amt;
  $('ins-overlay').classList.add('vis');
  $('btn-ins-yes').onclick=()=>{
    $('ins-overlay').classList.remove('vis');
    balance-=amt; updateBal(); cb(amt);
  };
  $('btn-ins-no').onclick=()=>{$('ins-overlay').classList.remove('vis');cb(0)};
}

// â”€â”€â”€ DEAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function deal(){
  const bet=parseInt($('bet-in').value);
  if(isNaN(bet)||bet<1){setStatus('Please enter a valid bet.');return}
  if(bet>balance)      {setStatus('Bet exceeds your balance!');return}
  currentBet=bet; balance-=bet; handBets=[bet];
  updateBal(); $('cur-bet').textContent=currentBet;
  playerHands=[[]]; dealerHand=[]; activeIdx=0; holeRevealed=false; insuranceBet=0;
  playerHands[0].push(draw(),draw());
  dealerHand.push(draw(),draw());
  renderDealer(false); renderPlayer(); setButtons(false); showTell();
  if(dealerHand[0].v==='A'){
    offerInsurance(amt=>{insuranceBet=amt;checkBJs()});
  } else {
    checkBJs();
  }
}

function checkBJs(){
  const pBJ=isBJ(playerHands[0]), dBJ=isBJ(dealerHand);
  if(pBJ||dBJ){
    setTimeout(()=>revealHole(()=>{
      if(insuranceBet>0&&dBJ){balance+=insuranceBet*3;updateBal()}
      resolve();
    }),400);
  } else {
    gameState='playing'; setButtons(true);
    setStatus('Your move â€” hit or stand?'); updateHint();
  }
}

// â”€â”€â”€ HIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hit(){
  if(gameState!=='playing')return;
  const hand=playerHands[activeIdx];
  hand.push(draw()); renderPlayer(); updateHint();
  if(isBust(hand)){
    if(playerHands.length>1&&activeIdx===0){
      activeIdx=1; renderPlayer(); updateHint();
      setStatus('Hand 1 busted! Playing Hand 2.'); setButtons(true);
    } else {
      setButtons(false); revealHole(()=>resolve());
    }
  } else setButtons(true);
}

// â”€â”€â”€ STAND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function stand(){
  if(gameState!=='playing')return;
  if(playerHands.length>1&&activeIdx===0){
    activeIdx=1; renderPlayer(); updateHint();
    setStatus('Hand 1 done! Playing Hand 2.'); setButtons(true); return;
  }
  setButtons(false); revealHole(()=>dealerPlay());
}

// â”€â”€â”€ DOUBLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function dblDown(){
  if(gameState!=='playing')return;
  const bet=handBets[activeIdx];
  balance-=bet; handBets[activeIdx]*=2;
  currentBet=handBets.reduce((a,b)=>a+b,0);
  updateBal(); $('cur-bet').textContent=currentBet;
  playerHands[activeIdx].push(draw()); renderPlayer(); setButtons(false);
  setTimeout(()=>revealHole(()=>{
    if(playerHands.length>1&&activeIdx===0){
      activeIdx=1; renderPlayer(); updateHint();
      setStatus('Doubled! Playing Hand 2.'); setButtons(true);
    } else dealerPlay();
  }),350);
}

// â”€â”€â”€ SPLIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function splitHand(){
  if(gameState!=='playing')return;
  const bet=handBets[0]; balance-=bet; updateBal();
  handBets=[bet,bet]; currentBet=bet*2; $('cur-bet').textContent=currentBet;
  const c2=playerHands[0].pop();
  playerHands.push([c2]);
  playerHands[0].push(draw()); playerHands[1].push(draw());
  activeIdx=0; renderPlayer(); updateHint(); setButtons(true);
  setStatus('Split! Playing Hand 1 â€” hit or stand?');
}

// â”€â”€â”€ REVEAL HOLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function revealHole(cb){
  gameState='dealer'; holeRevealed=true;
  const inner=$('hole');
  if(inner){
    inner.classList.add('flipped');
    setTimeout(()=>{renderDealer(true);if(cb)cb()},580);
  } else {renderDealer(true);if(cb)cb()}
}

// â”€â”€â”€ DEALER PLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function dealerPlay(){
  setStatus('The lobster is thinking... ğŸ¦');
  $('hint-bar').className='hint-bar h-off'; $('hint-bar').textContent='';
  function step(){
    const s=score(dealerHand);
    // dealer hits on < 17, and on soft 17
    if(s<17||(s===17&&isSoft(dealerHand))){
      dealerHand.push(draw()); renderDealer(true); setTimeout(step,650);
    } else resolve();
  }
  setTimeout(step,350);
}

// â”€â”€â”€ RESOLVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resolve(){
  gameState='done'; renderDealer(true); $('tell').style.opacity=0;
  const dS=score(dealerHand), dBJ=isBJ(dealerHand), dB=isBust(dealerHand);
  let totalReturn=0, outcomes=[];

  for(let i=0;i<playerHands.length;i++){
    const hand=playerHands[i], pS=score(hand);
    const pBJ=isBJ(hand)&&playerHands.length===1;
    const pB=isBust(hand), bet=handBets[i]||handBets[0];
    if(pB){outcomes.push('lose')}
    else if(dB||pS>dS){
      if(pBJ&&!dBJ){totalReturn+=Math.floor(bet*2.5);outcomes.push('bj')}
      else          {totalReturn+=bet*2;              outcomes.push('win')}
    } else if(pS===dS){
      if(pBJ&&!dBJ){totalReturn+=Math.floor(bet*2.5);outcomes.push('bj')}
      else          {totalReturn+=bet;                outcomes.push('push')}
    } else outcomes.push('lose');
  }

  balance+=totalReturn; updateBal();

  let msg,cls;
  if(outcomes.includes('bj'))    {msg='ğŸ¦ğŸ‹ BLACKJACK! Natural 21! 1.5Ã— payout!';cls='bj';spawnParticles('bj')}
  else if(dBJ&&!isBJ(playerHands[0])){msg='ğŸ¦ The lobster claws back your chips.';cls='lose';animSec('anim-shake')}
  else if(outcomes.every(o=>o==='lose')){msg='ğŸ¦ The lobster claws back your chips.';cls='lose';animSec('anim-shake')}
  else if(outcomes.every(o=>o==='push')){msg='ğŸ‹ A squeeze â€” it\'s a tie! Bet returned.';cls='push'}
  else if(outcomes.some(o=>o==='win'))  {msg='ğŸ‰ You win! The lobster is furious.';cls='win';animSec('anim-glow');spawnParticles('win')}
  else                                  {msg='ğŸ‹ A squeeze â€” it\'s a tie! Bet returned.';cls='push'}

  if(insuranceBet>0&&!dBJ) msg+=' (Insurance lost)';
  setStatus(msg,cls);
  setButtons(false);
  $('btn-deal').disabled=false; $('bet-in').disabled=false;
  $('hint-bar').className='hint-bar h-off'; $('hint-bar').textContent='';
  if(balance<=0) setTimeout(()=>$('go').classList.add('vis'),1300);
}

// â”€â”€â”€ ANIMATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function animSec(cls){
  const el=$('player-wrap');
  el.classList.remove('anim-glow','anim-shake'); void el.offsetWidth;
  el.classList.add(cls); setTimeout(()=>el.classList.remove(cls),1400);
}

// â”€â”€â”€ PARTICLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const cvs=$('particle-canvas'), cx=cvs.getContext('2d');
let parts=[], rafId=null;
window.addEventListener('resize',()=>{cvs.width=innerWidth;cvs.height=innerHeight});
cvs.width=innerWidth; cvs.height=innerHeight;

function spawnParticles(type){
  const ox=innerWidth/2, oy=innerHeight/2;
  const n=type==='bj'?70:40;
  for(let i=0;i<n;i++){
    const a=Math.random()*Math.PI*2, sp=3+Math.random()*6;
    const emoji=type==='bj'
      ?['ğŸ¦','ğŸ‹','â­','âœ¨','ğŸ‰','ğŸ’›'][~~(Math.random()*6)]
      :null;
    parts.push({
      x:ox,y:oy,vx:Math.cos(a)*sp*(0.5+Math.random()),
      vy:Math.sin(a)*sp*(0.5+Math.random())-(type==='bj'?2.5:1.5),
      size:emoji?14+Math.random()*10:6+Math.random()*6,
      emoji,color:emoji?null:['#ffd700','#f5e642','#e8523a','#fff'][~~(Math.random()*4)],
      life:1,decay:.011+Math.random()*.011,gravity:.16
    });
  }
  if(!rafId) animParts();
}
function animParts(){
  cx.clearRect(0,0,cvs.width,cvs.height);
  parts=parts.filter(p=>p.life>0);
  for(const p of parts){
    p.x+=p.vx; p.y+=p.vy; p.vy+=p.gravity; p.life-=p.decay;
    cx.save(); cx.globalAlpha=Math.max(0,p.life);
    if(p.emoji){cx.font=p.size+'px serif';cx.fillText(p.emoji,p.x,p.y)}
    else{cx.fillStyle=p.color;cx.beginPath();cx.arc(p.x,p.y,p.size/2,0,Math.PI*2);cx.fill()}
    cx.restore();
  }
  rafId=parts.length>0?requestAnimationFrame(animParts):(cx.clearRect(0,0,cvs.width,cvs.height),null);
}

// â”€â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetGame(){
  balance=1000; currentBet=0; handBets=[]; playerHands=[[]]; dealerHand=[];
  activeIdx=0; gameState='idle'; holeRevealed=false; insuranceBet=0;
  $('go').classList.remove('vis');
  ['d-cards','p-cards','p-cards1'].forEach(id=>$(id).innerHTML='');
  $('d-score').textContent=$('p-score').textContent='--';
  $('cur-bet').textContent='0'; $('bet-in').value=10;
  $('sl0').style.display=$('sl1').style.display='none';
  $('p-cards1').style.display='none';
  $('tell').style.opacity=0; $('hint-bar').className='hint-bar h-off';
  updateBal(); setButtons(false); setStatus('Place your bet and click Deal to begin.');
  buildShoe();
}

// â”€â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(which){$(`${which}-modal`).classList.add('vis')}
function closeModal(id){$(id).classList.remove('vis')}
function bgClose(e,id){if(e.target===modal(id))closeModal(id)}
function modal(id){return$(id)}

// â”€â”€â”€ KEYBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown',e=>{
  if($('howto-modal').classList.contains('vis')||$('about-modal').classList.contains('vis')){
    if(e.key==='Escape'){closeModal('howto-modal');closeModal('about-modal')}return;
  }
  if($('ins-overlay').classList.contains('vis'))return;
  switch(e.key.toUpperCase()){
    case 'D':if(!$('btn-deal').disabled)deal();break;
    case 'H':if(!$('b-hit').disabled)hit();break;
    case 'S':if(!$('b-stand').disabled)stand();break;
    case 'W':if(!$('b-dbl').disabled)dblDown();break;
    case 'P':if(!$('b-spl').disabled)splitHand();break;
  }
});

// â”€â”€â”€ UTIL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function $(id){return document.getElementById(id)}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
buildShoe(); updateBal(); setButtons(false);

// Show how-to on first load
setTimeout(()=>openModal('howto'), 300);
</script>
</body>
</html>
